<div class="hero-journey-container">
  <div class="hero-journey-header">
    <h1>The Hero's Journey</h1>
    <p class="intro">
      The Hero's Journey is a common story structure where a hero ventures out from the familiar world, 
      faces challenges and transformation, and returns home changed. Click on any stage to explore.
    </p>
  </div>

  <div class="content-wrapper">
    <div class="diagram-section">
    <svg [attr.viewBox]="'0 0 ' + svgWidth + ' ' + svgHeight" 
         class="hero-journey-svg"
         role="img"
         aria-labelledby="hj-title hj-desc">
      
      <title id="hj-title">The Hero's Journey Interactive Diagram</title>
      <desc id="hj-desc">A circular diagram showing the 12 stages of the Hero's Journey, divided between the Known World and Unknown World. Click on any stage to learn more.</desc>
      
      <!-- Background sections for Journey Phases -->
      <g class="phase-sections">
        <!-- Departure (stages 1-5) -->
        <path [attr.d]="getArcPath(0, 150, outerRadius)" 
              class="departure-section"
              [attr.fill]="'#CFE7F5'"
              opacity="0.25"/>
        
        <!-- Initiation (stages 6-9) -->
        <path [attr.d]="getArcPath(150, 270, outerRadius)" 
              class="initiation-section"
              [attr.fill]="'#00CD92'"
              opacity="0.2"/>
        
        <!-- Return (stages 10-12) -->
        <path [attr.d]="getArcPath(270, 360, outerRadius)" 
              class="return-section"
              [attr.fill]="'#FF9A15'"
              opacity="0.15"/>
      </g>

      <!-- Phase Labels -->
      <text x="500" y="250" class="phase-label" text-anchor="middle">
        DEPARTURE
      </text>
      <text x="200" y="400" class="phase-label" text-anchor="middle">
        INITIATION
      </text>
      <text x="500" y="550" class="phase-label" text-anchor="middle">
        RETURN
      </text>

      <!-- Central Abyss/Ordeal -->
      <g class="abyss-center">
        <circle [attr.cx]="centerX" 
                [attr.cy]="centerY" 
                [attr.r]="abyssRadius"
                class="abyss-circle"
                [attr.fill]="'#D83506'"
                opacity="0.15"/>
        
        <!-- Known World label above Abyss -->
        <text [attr.x]="centerX" 
              [attr.y]="centerY - abyssRadius - 20" 
              text-anchor="middle" 
              class="world-label">
          KNOWN WORLD
        </text>
        
        <text [attr.x]="centerX" 
              [attr.y]="centerY - 20" 
              text-anchor="middle" 
              class="abyss-label">
          ABYSS
        </text>
        <text [attr.x]="centerX" 
              [attr.y]="centerY + 5" 
              text-anchor="middle" 
              class="abyss-sublabel">
          Crisis & Rebirth
        </text>
        
        <!-- Unknown World label below Abyss -->
        <text [attr.x]="centerX" 
              [attr.y]="centerY + abyssRadius + 35" 
              text-anchor="middle" 
              class="world-label">
          UNKNOWN WORLD
        </text>
      </g>

      <!-- Journey Path -->
      <path [attr.d]="getPathData()" 
            class="journey-path"
            fill="none"
            stroke="#009AD7"
            stroke-width="3"
            stroke-dasharray="5,5"/>
      
      <!-- Progress Path (animated) -->
      <path [attr.d]="getProgressPathData()" 
            class="progress-path"
            fill="none"
            stroke="#FF9A15"
            stroke-width="4"
            stroke-linecap="round"/>

      <!-- Direction arrows -->
      <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" 
                refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#009AD7" />
        </marker>
      </defs>

      <!-- Stage segments and interactivity -->
      <g class="stages">
        <g *ngFor="let stage of stages" 
           class="stage-group"
           [class.selected]="selectedStage?.id === stage.id"
           [class.threshold]="stage.isThreshold"
           [class.return-path]="stage.isReturnPath"
           (click)="onStageClick(stage)"
           [attr.tabindex]="0"
           (keyup.enter)="onStageClick(stage)"
           (keyup.space)="onStageClick(stage)"
           role="button"
           [attr.aria-label]="'Stage ' + stage.id + ': ' + stage.name">
          
          <!-- Stage circle -->
          <circle [attr.cx]="getStageX(stage)" 
                  [attr.cy]="getStageY(stage)" 
                  r="20"
                  [attr.fill]="stage.worldType === 'known' ? '#70B7E2' : '#00CD92'"
                  [attr.stroke]="stage.isThreshold ? '#FF9A15' : (stage.isAbyss ? '#D83506' : '#009AD7')"
                  [attr.stroke-width]="stage.isThreshold || stage.isAbyss ? '4' : '2'"
                  class="stage-circle"/>
          
          <!-- Stage number -->
          <text [attr.x]="getStageX(stage)" 
                [attr.y]="getStageY(stage) + 5" 
                text-anchor="middle"
                class="stage-number"
                fill="white"
                font-weight="bold">
            {{stage.id}}
          </text>
          
          <!-- Stage label -->
          <text [attr.x]="getLabelX(stage)" 
                [attr.y]="getLabelY(stage)" 
                [attr.text-anchor]="getTextAnchor(stage)"
                class="stage-label">
            {{stage.name}}
          </text>

          <!-- Threshold marker -->
          <g *ngIf="stage.isThreshold">
            <line [attr.x1]="getStageX(stage) - 30" 
                  [attr.y1]="getStageY(stage)" 
                  [attr.x2]="getStageX(stage) + 30" 
                  [attr.y2]="getStageY(stage)"
                  stroke="#FF9A15"
                  stroke-width="4"
                  class="threshold-line"/>
          </g>

          <!-- Abyss connection -->
          <g *ngIf="stage.isAbyss">
            <line [attr.x1]="centerX" 
                  [attr.y1]="centerY" 
                  [attr.x2]="getStageX(stage)" 
                  [attr.y2]="getStageY(stage)"
                  stroke="#D83506"
                  stroke-width="2"
                  stroke-dasharray="3,3"
                  opacity="0.5"/>
          </g>
        </g>
      </g>

      <!-- Legend -->
      <g class="legend" transform="translate(20, 720)">
        <text x="0" y="0" class="legend-title">Journey Phases:</text>
        
        <rect x="10" y="10" width="20" height="20" fill="#CFE7F5" opacity="0.25"/>
        <text x="40" y="25" class="legend-text">Departure (1-5)</text>
        
        <rect x="150" y="10" width="20" height="20" fill="#00CD92" opacity="0.2"/>
        <text x="180" y="25" class="legend-text">Initiation (6-9)</text>
        
        <rect x="290" y="10" width="20" height="20" fill="#FF9A15" opacity="0.15"/>
        <text x="320" y="25" class="legend-text">Return (10-12)</text>
        
        <line x1="440" y1="20" x2="470" y2="20" stroke="#FF9A15" stroke-width="4"/>
        <text x="480" y="25" class="legend-text">Threshold</text>
        
        <circle cx="600" cy="20" r="10" fill="#D83506" opacity="0.3"/>
        <text x="620" y="25" class="legend-text">Abyss/Ordeal</text>
      </g>
    </svg>

      <!-- Instruction hint -->
      <p class="instruction-hint" *ngIf="!selectedStage">
        <strong>Tip:</strong> Click on each stage of the circle to learn about that part of the Hero's Journey.
      </p>
    </div>

    <!-- Side panel for stage details -->
    <div class="detail-panel" [class.active]="selectedStage">
      <div class="panel-header" *ngIf="!selectedStage">
        <h2>Select a Stage</h2>
        <p>Click on any numbered stage in the diagram to explore its meaning in the Hero's Journey.</p>
      </div>

      <div class="stage-detail-content" *ngIf="selectedStage">
        <div class="stage-header">
          <div class="stage-number-badge" [class.known-world]="selectedStage.worldType === 'known'" 
               [class.unknown-world]="selectedStage.worldType === 'unknown'">
            {{selectedStage.id}}
          </div>
          <h2>{{selectedStage.name}}</h2>
        </div>

        <div class="stage-metadata">
          <span class="world-type" [class.known]="selectedStage.worldType === 'known'" 
                [class.unknown]="selectedStage.worldType === 'unknown'">
            {{selectedStage.worldType === 'known' ? 'Known World' : 'Unknown World'}}
          </span>
          <span *ngIf="selectedStage.isThreshold" class="special-marker threshold">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 0l2 6h6l-5 4 2 6-5-4-5 4 2-6-5-4h6z"/>
            </svg>
            Threshold
          </span>
          <span *ngIf="selectedStage.isAbyss" class="special-marker abyss">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <circle cx="8" cy="8" r="8"/>
            </svg>
            Central Crisis
          </span>
          <span *ngIf="selectedStage.isReturnPath" class="special-marker return">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M1 8h10m-5-5l5 5-5 5"/>
            </svg>
            Return Journey
          </span>
        </div>

        <div class="stage-description">
          <p>{{selectedStage.description}}</p>
        </div>

        <div class="navigation-controls">
          <button class="nav-button prev" (click)="navigateStage('prev')" 
                  [attr.aria-label]="'Previous stage'"
                  [disabled]="currentStageIndex === 0">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M12 15l-5-5 5-5"/>
            </svg>
            Previous
          </button>
          
          <button class="nav-button next" (click)="navigateStage('next')" 
                  [attr.aria-label]="'Next stage'"
                  [disabled]="currentStageIndex === stages.length - 1">
            Next
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M8 5l5 5-5 5"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Stage groups overview -->
      <div class="stage-groups">
        <h3>Journey Phases</h3>
        <div *ngFor="let group of getStageGroups()" class="stage-group-card">
          <h4>{{group.name}}</h4>
          <p>{{group.description}}</p>
          <p class="stages-list">Stages {{group.stages[0]}}-{{group.stages[group.stages.length - 1]}}</p>
        </div>
      </div>
    </div>
  </div>
</div>